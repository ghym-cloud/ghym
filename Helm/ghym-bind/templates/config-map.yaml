apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Release.Name }}-conf-root
  namespace: {{ .Release.Namespace }}
data:
  named.conf: |
    include "/etc/bind/named.conf.logging";
    include "/etc/bind/named.conf.options";
    include "/etc/bind/custom/conf/0.16.172.in-addr.arpa.conf";
    include "/etc/bind/custom/conf/ghym.local.conf";
  named.conf.logging: |
    logging {
      category default { default_stderr; };
      category queries { default_stderr; };
    };
  named.conf.options: |
    options {
      directory "/var/cache/bind";
      dnssec-validation no;
      auth-nxdomain no;    # conform to RFC1035
      listen-on-v6 { any; };
      max-cache-size 90%;
      response-policy { zone "ghym.local"; };
      forwarders {
        {{- range .Values.nameservers }}
        {{ . }}{{ ";" }}
        {{- end }}
      };
      recursion yes;
      allow-recursion {
        any;
      };
      allow-query {
        any;
      };
    };
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Release.Name }}-conf-custom
  namespace: {{ .Release.Namespace }}
data:
  0.16.172.in-addr.arpa.conf: |
    zone "0.16.172.in-addr.arpa" {
      type master;
      allow-transfer { any; };
      allow-update { any; };
      file "/etc/bind/custom/zone/0.16.172.in-addr.arpa";
    };
  ghym.local.conf: |
    zone "ghym.local" IN {
      type master;
      allow-transfer { any; };
      allow-update { any; };
      file "/etc/bind/custom/zone/ghym.local";
    };
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Release.Name }}-conf-zone
  namespace: {{ .Release.Namespace }}
data:
  0.16.172.in-addr.arpa: |
    $TTL 3600
    @                               IN   SOA     ghym.local.  info.ghym.local. (
                                                 2023121601   ; Serial number
                                                 1200         ; Refresh time
                                                 180          ; Retry time
                                                 1209600      ; Expiry time
                                                 10800        ; Negative Cache TTL
    )
    @   IN  NS  ae-dc1-cp3.             ; PTR
    1	IN	PTR	ae-dc1-gw.ghym.local.   ; Gateway
    14	IN	PTR	ae-dc1-5.ghym.local.    ; Hyper-V
    15	IN	PTR	ae-dc1-cp3.ghym.local.  ; Control plane
    16	IN	PTR	ae-dc1-wn5.ghym.local.  ; Worker node 1
    17	IN	PTR	ae-dc1-wn5.ghym.local.  ; Worker node 2
  ghym.local: |
    $TTL 3600
    @                               IN   SOA     ghym.local.  info.ghym.local. (
                                                 2023121601   ; Serial number
                                                 1200         ; Refresh time
                                                 180          ; Retry time
                                                 1209600      ; Expiry time
                                                 10800        ; Negative Cache TTL
    )
    @             IN  NS    ae-dc1-cp3. ; A
    ae-dc1-gw	  IN  A	    172.16.0.1  ; Gateway
    ae-dc1-5	  IN  A	    172.16.0.14 ; Hyper-V
    ae-dc1-cp3	  IN  A	    172.16.0.15 ; Control plane
    ae-dc1-wn5	  IN  A	    172.16.0.16 ; Worker node 1
    ae-dc1-wn6    IN  A	    172.16.0.17 ; Worker node 2
    www           IN  CNAME ae-dc1-cp3  ; Ingress
    kadyshev      IN  CNAME ae-dc1-cp3  ; Ingress
    prometheus    IN  CNAME ae-dc1-cp3  ; Ingress
    grafana       IN  CNAME ae-dc1-cp3  ; Ingress
    jenkins       IN  CNAME ae-dc1-cp3  ; Ingress
    gitlab        IN  CNAME ae-dc1-cp3  ; Ingress
    dashboard     IN  CNAME ae-dc1-cp3  ; Ingress
    alertmanager  IN  CNAME ae-dc1-cp3  ; Ingress
